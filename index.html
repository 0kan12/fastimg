<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FastIMG</title>
    <link rel="stylesheet" href="styles2.css">
</head>
<body>
    <h2>Resim YÃ¼kleme</h2>
    <form id="imageForm">
        <div style="display: flex; justify-content: space-between;">
            <div style="width: 48%;">
                <label for="file-input" id="custom-file-button">
                    Dosya SeÃ§
                </label>
                <input type="file" id="file-input"  accept=".png,.jpg,.jpeg" name="file" style="display: none;">
                <div id="file-label">Dosya SeÃ§ilmedi</div>
            </div>
            <div style="width: 48%; text-align: right;">
                <button type="button" id="uploadButton" title="Resmi yÃ¼kle">Resmi YÃ¼kle ðŸ“¤</button>
            </div>
        </div>
    </form>
    <div id="loadingLabel">Resminiz YÃ¼kleniyor...</div>
    <div id="result"></div>
    <h6>Bu hizmeti kullanarak <a target="_blank" href="https://creativestudioss.online/tos">kullanÄ±m koÅŸullarÄ±mÄ±zÄ±</a> kabul etmiÅŸ olursunuz</h6>
    <button id="copyButton" onclick="copyLink()" title="Linki Kopyala">Linki Kopyala ðŸ”—</button>
    <script>
        const fileInput = document.getElementById('file-input');
        const fileLabel = document.getElementById('file-label');

        fileInput.addEventListener('change', function () {
            const fileName = this.value.split('\\').pop();
            fileLabel.innerHTML = fileName !== '' ? `SeÃ§ilen Dosya: ${fileName}` : 'Dosya SeÃ§ilmedi';
        });
        document.getElementById('uploadButton').addEventListener('click', function() {
            var fileInput = document.getElementById('file-input');
            var file = fileInput.files[0];
            var name = file.name;
            if (file) {
                document.getElementById('loadingLabel').style.display = 'block';

                var reader = new FileReader();
                reader.readAsDataURL(file);

                reader.onload = function() {
                    var base64Content = reader.result.split(',')[1];
                    uploadToJSONBlob(base64Content, name);
                };
            } else {
                alert('LÃ¼tfen bir resim seÃ§in.');
            }
        });

        function uploadToJSONBlob(content, name) {
            var apiUrl = 'https://jsonblob.com/api/jsonBlob';
            var urla='https://fastimg.pythonanywhere.com/new_img_link?id='
            var bugununTarihi = new Date().toLocaleString('tr-TR', { day: 'numeric', month: 'numeric', year: 'numeric', hour: 'numeric', minute: 'numeric' });
            console.log(bugununTarihi);
            var jsonData = { "content": content, "name": name ,"date":bugununTarihi};

            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(jsonData)
            })
            .then(response => {
                if (response.ok) {
                    var blobId = response.headers.get('Location').split('/').pop();
                    console.log("JSONBlob ID:", blobId);
                    fetch(urla+blobId,{
                        method: 'GET',
                    }).then(response=>{
                        if (response.ok) {
                            return response.json();
                        } else {
                            throw new Error('Hata: ' + response.statusText);
                        }
                    }).then(data=>{
                        short=data.data;
                        updateResult(short);
                    })
                    
                } else {
                    throw new Error('Hata: ' + response.statusText);
                }
            })
            .catch(error => {
                document.getElementById('result').innerHTML = 'Hata oluÅŸtu: ' + error.message;
            });
        }

        function updateResult(blobId) {
            var resultElement = document.getElementById('result');
            resultElement.innerHTML = 'Resim baÅŸarÄ±yla yÃ¼klendi. <br> Linkiniz: <a href="https://fastimg.creativestudioss.online/' + blobId + '" target="_blank">https://fastimg.creativestudioss.online/' + blobId + '</a> <br>';
            resultElement.innerHTML += "QrCode oluÅŸturmak iÃ§in : <a target='_black' href=https://qrgen.creativestudioss.online?data=https://fastimg.creativestudioss.online/" + blobId + ">TÄ±klayÄ±n</a>";
            resultElement.innerHTML += '<br> Linki kopyalamak iÃ§in "Linki Kopyala" butonunu kullanabilirsiniz.';
            document.getElementById('copyButton').style.display = 'block';
            resultElement.style.display="block"
            document.getElementById('loadingLabel').style.display = 'none';
        }

        function copyLink() {
            var resultLink = document.createElement('textarea');
            resultLink.value = document.getElementById('result').getElementsByTagName('a')[0].innerText;
            document.body.appendChild(resultLink);
            resultLink.select();
            document.execCommand('copy');
            document.body.removeChild(resultLink);
            alert('Link kopyalandÄ±!');
        }
    </script>
</body>
</html>